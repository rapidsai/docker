name: Test notebooks

on:
  workflow_call:
    inputs:
      ARCH:
        required: true
        type: string
      GPU:
        required: true
        type: string
      DRIVER:
        required: true
        type: string
      CUDA_VER:
        required: true
        type: string
      LINUX_VER:
        required: true
        type: string
      PYTHON_VER:
        required: true
        type: string
      RAPIDS_VER:
        required: true
        type: string
      # DASK_SQL_VER:
      #   required: true
      #   type: string
      # BASE_TAG:
      #   required: true
      #   type: string
      NOTEBOOKS_TAG:
        required: true
        type: string

jobs:
  docker-test:
    runs-on: "linux-${{ inputs.ARCH }}-gpu-${{ inputs.GPU }}-${{ inputs.DRIVER }}-1"
    container:
      image: ${{ inputs.NOTEBOOKS_TAG }}
      options: --user rapids
      env:
        #RAPIDS_BUILD_TYPE: ${{ inputs.build_type }}
        #PARALLEL_LEVEL: ${{ env.PARALLEL_LEVEL }}
        NVIDIA_VISIBLE_DEVICES: ${{ env.NVIDIA_VISIBLE_DEVICES }}
    steps:
      - name: Test notebooks
        run: /home/rapids/test_notebooks.py
      # TODO: archive outputs
